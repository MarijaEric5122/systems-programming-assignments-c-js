<!doctypehtml><html lang=sr><head><meta charset=utf-8><title>Zadatak 3</title></head><body><h3>Zadatak 3 – Histogram osvetljenosti</h3><input id=imgInput type=file><br><br><button disabled id=btnHist>Generisi histogram</button><br><br><div style=display:flex;gap:30px;align-items:flex-start><div><h4>Slika (original → grayscale)</h4><canvas id=canvasImg style="border:1px solid #ccc"></canvas></div><div><h4>Histogram</h4><canvas id=histCanvas style="border:1px solid #ccc"height=200 width=500></canvas></div></div><script>var Module={onRuntimeInitialized(){document.getElementById("btnHist").disabled=!1}}</script><script async src=luminosity.js></script><script>const imgInput=document.getElementById("imgInput"),btnHist=document.getElementById("btnHist"),canvasImg=document.getElementById("canvasImg"),ctxImg=canvasImg.getContext("2d"),histCanvas=document.getElementById("histCanvas"),hctx=histCanvas.getContext("2d");let imgWidth=0,imgHeight=0,origData=null;function drawHistogramLine(t){const e=histCanvas.width,a=histCanvas.height;hctx.clearRect(0,0,e,a);const n=Math.max(...t),i=e/(t.length-1),c=n>0?(a-20)/n:0;hctx.strokeStyle="#aaa",hctx.beginPath(),hctx.moveTo(0,a-10),hctx.lineTo(e,a-10),hctx.moveTo(10,0),hctx.lineTo(10,a),hctx.stroke(),hctx.strokeStyle="#2ecc71",hctx.lineWidth=2,hctx.beginPath(),t.forEach(((t,e)=>{const n=e*i,g=a-10-t*c;0===e?hctx.moveTo(n,g):hctx.lineTo(n,g)})),hctx.stroke()}imgInput.addEventListener("change",(function(t){const e=t.target.files[0];if(!e)return;const a=new Image;a.onload=function(){imgWidth=a.width,imgHeight=a.height,canvasImg.width=imgWidth,canvasImg.height=imgHeight,ctxImg.drawImage(a,0,0),origData=ctxImg.getImageData(0,0,imgWidth,imgHeight),hctx.clearRect(0,0,histCanvas.width,histCanvas.height)},a.src=URL.createObjectURL(e)})),btnHist.addEventListener("click",(function(){if(!origData)return void alert("Prvo izaberite sliku.");const t=new ImageData(new Uint8ClampedArray(origData.data),imgWidth,imgHeight),e=t.data,a=e.length,n=Module._malloc(a);Module.HEAPU8.set(e,n);const i=Module._malloc(1024);Module.ccall("grayscale_and_hist",null,["number","number","number"],[n,a,i]);const c=Module.HEAPU8.subarray(n,n+a);t.data.set(c),ctxImg.putImageData(t,0,0);const g=new Uint32Array(256),o=i>>2;for(let t=0;t<256;t++)g[t]=Module.HEAP32[o+t];Module._free(n),Module._free(i),drawHistogramLine(g)}))</script></body></html>